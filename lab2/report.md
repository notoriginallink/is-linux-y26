# lab 2

### 0. Проверка связи между машинами и наличие дисков
ip-server: 10.0.2.15/24
ip-client: 10.0.2.9/24
Пинги с каждой машины на соответствующие адреса выполняются

Проверить наличие дисков можно выполнив на server команду lsblk (list block == список блочных устройств)
Вывод:
```
NAME   MAJ:MIN RM  SIZE RO TYPE MOUNTPOINTS
sda      8:0    0   20G  0 disk 
├─sda1   8:1    0 17,2G  0 part /
└─sda2   8:2    0  2,8G  0 part [SWAP]
sdb      8:16   0    2G  0 disk   
sdc      8:32   0    2G  0 disk 
sdd      8:48   0    2G  0 disk 
sde      8:64   0    2G  0 disk 
sr0     11:0    1 1024M  0 rom  
```
sdb, sdc, sdd, sde - добавленные диски

---

### 1. Создать новый раздел размером 500МБ на первом диске (sdb), начинающийся с первого свободного сектора
Запускаем утилиту fdisk для первого диска
```
fdisk /dev/sdb
```
Далее в её интерфейсе поочередно выполняем команды
- `n` - создание нового раздела
- `p` - создание основного раздела (или `e` - для расширенного)
- `1` - для выбора раздела
- **Enter** - для выбора первого свободного сектора
- `+500M` - указание размера раздела
- `w` - сохранение результатов

Теперь можно убедиться, что раздел создан с помощью lsblk
```
NAME   MAJ:MIN RM  SIZE RO TYPE MOUNTPOINTS
sda      8:0    0   20G  0 disk 
├─sda1   8:1    0 17,2G  0 part /
└─sda2   8:2    0  2,8G  0 part [SWAP]
sdb      8:16   0    2G  0 disk 
└─sdb1   8:17   0  500M  0 part 		# Созданный раздел
sdc      8:32   0    2G  0 disk 
sdd      8:48   0    2G  0 disk 
sde      8:64   0    2G  0 disk 
sr0     11:0    1 1024M  0 rom  
```

---

### 2. Сохранить UUID созданного раздела в домашний каталог root
UUID раздела можно узнать с помощью утилиты blkid или `lsblk -f`
``` bash
blkid /dev/sdb1
```

Но для раздела **sdb1** еще не назначен UUID так как раздел не был отформатирован

---

### 3. Создать на разделе sdb1 файловую систему *ext4* с размером блока 4096 байт
``` bash
mkfs.ext4 -b 4096 /dev/sdb1
```

Теперь вывод команды `blkid /dev/sdb1` выглядит так
```
/dev/sdb1: UUID="d9f4bafa-9eda-4eca-a119-661761123787" BLOCK_SIZE="4096" TYPE="ext4" PARTUUID="e0339f71-01"
```

И можно сохранить UUID в файл (пункт 2)
``` bash
blkid --match-tag UUID --output value /dev/sdb1 > /root/sdb1_uuid
```

---

### 4. Вывести текущее состояние параметров, записанных в суперблоке созданной файловой системы
``` bash
dumpe2fs /dev/sdb1
```

Или можно получить информацию только о параметрах суперблока с помощью
``` bash
tune2fs -l /dev/sdb1
```

---

### 5. Настроить автоматическую проверку файловой системы каждый 2 месяца или после каждого 2 монтирования
Настраивается с помощью утилиты tune2fs
``` bash
tune2fs -i 2m -c 2 /dev/sdb1
```
- `-i` - интервалы между проверками
- `-c` - максимальное число монтирований (после которых будет запущена проверка)

Теперь можно посмотреть текущие параметры автоматических проверок с помощью 
``` bash
tune2fs -l /dev/sdb1 | grep -E "(Check interval)|(Maximum mount count)"
```
Вывод команды:
```
Maximum mount count:      2
Check interval:           5184000 (2 months)
```

---

### 6. Создать в каталоге `/mnt` подкаталог *newdisk* и смонтировать в него созданную файловую систему
``` bash
mkdir /mnt/newdisk

mount /dev/sdb1 /mnt/newdisk
```

Теперь можно получить информацию о файловых системам с помощью утилиты `df`
``` bash
df /dev/sdb1
```
Вывод команды:
```
Файловая система 1K-блоков Использовано Доступно Использовано% Cмонтировано в
/dev/sdb1           462816           24   426952            1% /mnt/newdisk
```

---

### 7. Создать в домашнем каталоге root ссылку на смонтированную файловую систему
Создадим симлинк на созданный в прошлом пункте каталог
``` bash
ln -s /mnt/newdisk /root/sdb1.fs
```
Можно получить информацию о каталоге с помощью `ls -l /root/sdb1.fs`

Вывод:
```
lrwxrwxrwx 1 root root 13 фев 27 19:20 /root/sdb1.fs -> /mnt/newdisk/
```

---


